# 操作系统内核项目编码规范

## 1. 命名规范

### 1.1 文件命名
- 源文件使用小写字母，单词间用下划线连接（例如：kernel_memory.cpp）
- 头文件使用.h后缀，实现文件使用.cpp后缀
- 汇编文件使用.asm后缀

### 1.2 类命名
- 使用大驼峰命名法（例如：KernelMemory, ProcessManager）
- 类名应当清晰表达其功能和职责

### 1.3 函数命名
- 使用小驼峰命名法（例如：allocatePages, mapPage）
- 函数名应当是动词或动词短语

### 1.4 变量命名
- 成员变量使用小写字母，单词间用下划线连接（例如：page_manager, vmalloc_tree）
- 常量使用全大写字母，单词间用下划线连接（例如：PAGE_SIZE, KERNEL_DIRECT_MAP_START）

## 2. 代码格式

### 2.1 缩进和空格
- 使用4个空格进行缩进，不使用Tab
- 运算符两侧应当有空格
- 逗号后面应当有一个空格

### 2.2 大括号
- 左大括号与关键字在同一行
- 右大括号单独占一行
- if, for, while等语句即使只有一行也要使用大括号

### 2.3 行长度
- 每行代码不超过100个字符
- 如需换行，第二行相对第一行缩进4个空格

## 3. 注释规范

### 3.1 文件头注释
```cpp
/*
 * 文件名：xxx.cpp/h
 * 功能描述：...
 * 创建日期：YYYY-MM-DD
 */
```

### 3.2 函数注释
```cpp
/**
 * 函数功能描述
 * @param param1 参数1说明
 * @param param2 参数2说明
 * @return 返回值说明
 */
```

### 3.3 代码注释
- 复杂逻辑前添加注释说明
- 注释应当解释代码的「为什么」而不是「是什么」

## 4. 内存管理规范

### 4.1 内存分配
- 明确指定内存区域的用途（DMA、普通、高端）
- 检查内存分配的返回值
- 使用智能指针管理动态内存（如果支持）

### 4.2 内存释放
- 确保成对的分配和释放
- 防止内存泄漏和重复释放
- 在析构函数中释放所有动态分配的资源

## 5. 错误处理规范

### 5.1 返回值
- 使用明确的错误码或布尔值表示操作结果
- 对错误情况进行完整的处理

### 5.2 异常处理
- 在关键操作处添加错误检查
- 提供清晰的错误信息
- 保持系统在错误发生时的稳定性

## 6. 中断处理规范

### 6.1 中断处理函数
- 保持中断处理函数简短
- 避免在中断处理中执行耗时操作
- 正确保存和恢复上下文

### 6.2 中断禁用
- 最小化中断禁用时间
- 确保中断禁用和启用成对出现

## 7. 进程管理规范

### 7.1 进程创建
- 合理分配进程资源
- 初始化所有必要的进程属性
- 维护正确的进程状态转换

### 7.2 进程调度
- 实现公平的调度策略
- 防止进程饥饿
- 合理分配CPU时间片

## 8. 安全性规范

### 8.1 边界检查
- 对所有输入参数进行有效性验证
- 进行必要的地址范围检查
- 防止缓冲区溢出

### 8.2 权限控制
- 实现严格的用户态和内核态隔离
- 正确处理特权级转换
- 保护关键内核数据结构

## 9. 性能优化规范

### 9.1 代码优化
- 避免不必要的内存拷贝
- 减少锁的使用范围
- 优化频繁执行的代码路径

### 9.2 资源使用
- 合理使用缓存
- 及时释放不需要的资源
- 避免资源浪费

## 10. 版本控制规范

### 10.1 提交信息
- 提供清晰的提交描述
- 每个提交专注于单一功能或修复
- 保持提交历史的清晰性

### 10.2 分支管理
- 使用功能分支进行开发
- 及时合并和删除过期分支
- 保持主分支的稳定性